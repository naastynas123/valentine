<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Valentine ðŸ’˜</title>

<style>
:root{
  --glass: rgba(20,20,20,.45);
  --glass-border: rgba(255,255,255,.18);
  --text: #fff;

  --green: #46c26f;
  --green2:#2fb85c;
  --red: #f04a4a;
  --red2:#e23c3c;

  --envelope:#9fc7ff;
  --envelope-dark:#86b4ff;
  --paper:#ffffff;
  --seal:#ff5a7a;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
  overflow:hidden;
  background:#000;
}

/* ---- collage background ---- */
#collage{
  position:fixed; inset:0;
  display:grid;
  grid-template-columns: repeat(6, 1fr);
  grid-auto-rows: 160px;
  gap:14px;
  padding:18px;
  filter: saturate(1.05);
  transform: scale(1.04);
  z-index:0;
}
@media (max-width: 1100px){
  #collage{ grid-template-columns: repeat(4, 1fr); grid-auto-rows: 150px; }
}
@media (max-width: 700px){
  #collage{ grid-template-columns: repeat(3, 1fr); grid-auto-rows: 135px; }
}
.tile{
  border-radius:22px;
  overflow:hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,.55);
  position:relative;
  background:#111;
}
.tile img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transform: scale(1.02);
}
.tile:after{
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(circle at center, rgba(0,0,0,0) 40%, rgba(0,0,0,.45) 100%);
  pointer-events:none;
}

/* ---- main glass card ---- */
.centerWrap{
  position:fixed; inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:22px;
  z-index:2;
}
.glass{
  width:min(1050px, 95vw);
  min-height: min(560px, 86vh);
  border-radius:28px;
  padding:34px 26px;
  background: var(--glass);
  border:1px solid var(--glass-border);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  box-shadow: 0 30px 70px rgba(0,0,0,.6);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  gap:18px;
}

h1{
  margin:0;
  font-size: clamp(34px, 5vw, 62px);
  letter-spacing:.5px;
  text-shadow: 0 12px 24px rgba(0,0,0,.55);
  line-height:1.05;
}

/* audio button */
.audioBtn{
  border:0;
  border-radius:999px;
  padding:12px 18px;
  font-weight:800;
  font-size:15px;
  cursor:pointer;
  background: rgba(255,255,255,.14);
  color:#fff;
  border:1px solid rgba(255,255,255,.22);
  backdrop-filter: blur(10px);
  box-shadow: 0 10px 18px rgba(0,0,0,.28);
  transition: transform .12s ease, background .2s ease;
  display:inline-flex;
  align-items:center;
  gap:10px;
  user-select:none;
}
.audioBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.18); }
.audioBtn:active{ transform: translateY(1px) scale(.99); }
.audioDot{
  width:10px; height:10px; border-radius:999px;
  background:#ff4d6d;
  box-shadow: 0 0 0 5px rgba(255,77,109,.18);
}
.audioDot.on{
  background:#38d26a;
  box-shadow: 0 0 0 5px rgba(56,210,106,.18);
}

/* buttons */
.btnRow{
  display:flex;
  gap:16px;
  flex-wrap:wrap;
  justify-content:center;
  margin-top:10px;
}
  /* Make the button area an "arena" big enough to run around in */
#noZone{
  position: relative;
  width: 100%;
  min-height: 160px;     /* IMPORTANT: gives room to run */
  padding: 18px 12px;    /* keeps it inside nicely */
}

#noBtn.runaway{
  position: absolute;
  z-index: 4;
}

#yesBtn{
  position: relative;
  z-index: 5;            /* always clickable */
}

.btn{
  border:0;
  border-radius:999px;
  padding:14px 26px;
  font-weight:900;
  font-size:18px;
  cursor:pointer;
  color:#fff;
  box-shadow: 0 14px 30px rgba(0,0,0,.35);
  transition: transform .12s ease, filter .2s ease;
  user-select:none;
  min-width: 160px;
}
.btn:hover{ transform: translateY(-2px); filter: brightness(1.03); }
.btn:active{ transform: translateY(1px) scale(.99); }
.yes{ background: linear-gradient(180deg, var(--green), var(--green2)); }
.no{ background: linear-gradient(180deg, var(--red), var(--red2)); }

/* pages */
.page{ display:none; width:100%; }
.page.active{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; }

/* second screen envelope */
.envelopeWrap{ margin-top:12px; display:flex; justify-content:center; align-items:center; }
.envelope{
  width:min(520px, 82vw);
  height:320px;
  position:relative;
  cursor:pointer;
  user-select:none;
  filter: drop-shadow(0 18px 28px rgba(0,0,0,.45));
}
.env-body{
  position:absolute;
  inset:40px 0 0 0;
  border-radius:22px;
  background: var(--envelope);
  overflow:hidden;
}
.env-body:before{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(0,0,0,.06));
  pointer-events:none;
}
.env-flap{
  position:absolute;
  left:0; right:0; top:40px;
  height:160px;
  transform-origin: top center;
  transform: rotateX(0deg);
  transition: transform .55s cubic-bezier(.2,.8,.2,1);
  z-index:4;
}
.env-flap:before{
  content:"";
  position:absolute;
  left:0; right:0; top:0; bottom:0;
  background: var(--envelope-dark);
  clip-path: polygon(0 0, 100% 0, 50% 100%);
  border-top-left-radius:22px;
  border-top-right-radius:22px;
}
.seal{
  position:absolute;
  top:118px;
  left:50%;
  transform: translateX(-50%);
  width:64px; height:64px;
  border-radius:999px;
  background: var(--seal);
  display:grid;
  place-items:center;
  z-index:6;
  box-shadow: 0 10px 18px rgba(0,0,0,.25);
  border: 4px solid rgba(255,255,255,.25);
  transition: transform .55s cubic-bezier(.2,.8,.2,1);
}
.seal span{ font-size:22px; filter: drop-shadow(0 6px 10px rgba(0,0,0,.25)); }
.clickMeTag{
  position:absolute;
  left:50%;
  top:210px;
  transform: translateX(-50%);
  z-index:7;
  padding:10px 18px;
  border-radius:999px;
  background: rgba(255,255,255,.85);
  color:#0c1a33;
  font-weight:900;
  letter-spacing:.5px;
  box-shadow: 0 12px 18px rgba(0,0,0,.22);
}
.paper{
  position:absolute;
  left:22px;
  right:22px;
  top:86px;
  height:230px;
  background: var(--paper);
  border-radius:16px;
  z-index:2;
  transform: translateY(130px);
  transition: transform .55s cubic-bezier(.2,.8,.2,1);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
  overflow:hidden;
}
.paper:before{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,.04), rgba(0,0,0,0) 40%);
  pointer-events:none;
}
.envelope:hover .paper{ transform: translateY(-10px); }
.envelope:hover .env-flap{ transform: rotateX(165deg); }
.envelope:hover .seal{ transform: translateX(-50%) translateY(-10px) scale(.95); }

/* typed letter */
.letterCard{
  width:min(900px, 92vw);
  background: rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.18);
  border-radius:26px;
  padding:26px 22px;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  box-shadow: 0 22px 50px rgba(0,0,0,.55);
  text-align:left;
  line-height:1.5;
}
.letterTitle{
  margin:0 0 10px 0;
  font-size:22px;
  font-weight:900;
  letter-spacing:.3px;
}
.typed{
  font-size:18px;
  white-space:pre-wrap;
}
.cursor{
  display:inline-block;
  width:10px;
  margin-left:2px;
  background:#fff;
  animation: blink 1s infinite;
  vertical-align:baseline;
}
@keyframes blink{
  0%,49%{ opacity:1 }
  50%,100%{ opacity:0 }
}

/* confetti canvas */
#confetti{
  position:fixed; inset:0;
  pointer-events:none;
  z-index:5;
}

/* shade */
.shade{
  position:fixed; inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.55));
  z-index:1;
  pointer-events:none;
}

/* âœ… NO BUTTON GAME ANCHORS */
#noZone{
  position: relative;     /* anchor for absolute No */
  min-height: 90px;       /* room to move */
}
#yesBtn{
  position: relative;
  z-index: 5;             /* always clickable */
}
#noBtn.runaway{
  position: absolute;
  z-index: 4;
}
</style>
</head>

<body>
<!-- BACKGROUND COLLAGE -->
<div id="collage" aria-hidden="true"></div>
<div class="shade" aria-hidden="true"></div>

<!-- CONFETTI -->
<canvas id="confetti"></canvas>

<!-- AUDIO -->
<audio id="bgm" preload="auto" loop playsinline>
  <source src="song.mp3" type="audio/mpeg">
</audio>

<div class="centerWrap">
  <div class="glass">

    <!-- PAGE 1 -->
    <div id="page1" class="page active">
      <h1>Will you be my Valentine Quyen? ðŸ’˜</h1>

      <button id="soundBtn" class="audioBtn" type="button">
        <span id="audioDot" class="audioDot"></span>
        <span id="soundText">Play music</span>
      </button>

      <div id="noZone" class="btnRow">
        <button id="yesBtn" class="btn yes" type="button">Yes ðŸ’–</button>
        <button id="noBtn" class="btn no" type="button">No ðŸ¥º</button>
      </div>
    </div>

    <!-- PAGE 2 -->
    <div id="page2" class="page">
      <h1>YAY, 2 valentines down... 98 more to go!! ðŸ’ž</h1>
      <div class="envelopeWrap">
        <div id="envelope" class="envelope" role="button" aria-label="Open letter">
          <div class="paper"></div>
          <div class="env-body"></div>
          <div class="env-flap"></div>
          <div class="seal"><span>â™¥</span></div>
          <div class="clickMeTag">CLICK ME</div>
        </div>
      </div>
    </div>

    <!-- PAGE 3 -->
    <div id="page3" class="page">
      <div class="letterCard">
        <div class="letterTitle">ðŸ’Œ</div>
        <div class="typed"><span id="typedText"></span><span id="cursor" class="cursor">&nbsp;</span></div>
      </div>
    </div>

  </div>
</div>

<script>
/* -----------------------------
   COLLAGE (1.jpg .. 25.jpg in root)
------------------------------*/
const COLLAGE_COUNT = 25;
const collage = document.getElementById("collage");
for(let i=1;i<=COLLAGE_COUNT;i++){
  const tile = document.createElement("div");
  tile.className = "tile";

  const img = document.createElement("img");
  img.alt = `photo ${i}`;
  img.loading = "lazy";
  img.src = `${i}.jpg`;
  img.onerror = () => tile.style.display = "none";

  tile.appendChild(img);
  collage.appendChild(tile);
}

/* -----------------------------
   AUDIO (toggle)
------------------------------*/
const bgm = document.getElementById("bgm");
const soundBtn = document.getElementById("soundBtn");
const audioDot = document.getElementById("audioDot");
const soundText = document.getElementById("soundText");

function setAudioUI(playing){
  if(playing){
    audioDot.classList.add("on");
    soundText.textContent = "Music playing (click to pause)";
  }else{
    audioDot.classList.remove("on");
    soundText.textContent = "Play music";
  }
}
async function playMusic(){
  try{
    bgm.muted = false;
    bgm.volume = 0.8;
    await bgm.play();
    setAudioUI(true);
  }catch(e){
    setAudioUI(false);
    console.error(e);
  }
}
function pauseMusic(){
  bgm.pause();
  setAudioUI(false);
}
bgm.addEventListener("play",()=>setAudioUI(true));
bgm.addEventListener("pause",()=>setAudioUI(false));
soundBtn.addEventListener("click",()=>{ if(bgm.paused) playMusic(); else pauseMusic(); });

/* -----------------------------
   PAGES
------------------------------*/
const page1 = document.getElementById("page1");
const page2 = document.getElementById("page2");
const page3 = document.getElementById("page3");

function showPage(n){
  [page1,page2,page3].forEach(p=>p.classList.remove("active"));
  if(n===1) page1.classList.add("active");
  if(n===2) page2.classList.add("active");
  if(n===3) page3.classList.add("active");
}

/* -----------------------------
   CONFETTI
------------------------------*/
const confettiCanvas = document.getElementById("confetti");
const ctx = confettiCanvas.getContext("2d");

function resizeConfetti(){
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeConfetti);
resizeConfetti();

let confettiPieces = [];
let confettiOn = false;

function spawnConfetti() {
  confettiPieces = [];
  const count = 220;
  for (let i=0;i<count;i++){
    confettiPieces.push({
      x: Math.random()*confettiCanvas.width,
      y: -20 - Math.random()*confettiCanvas.height*0.3,
      w: 6 + Math.random()*10,
      h: 6 + Math.random()*14,
      vx: -2 + Math.random()*4,
      vy: 2 + Math.random()*6,
      r: Math.random()*Math.PI,
      vr: -0.2 + Math.random()*0.4,
      c: `hsl(${Math.floor(Math.random()*360)}, 90%, 60%)`,
      a: 0.85
    });
  }
  confettiOn = true;
  requestAnimationFrame(drawConfetti);
  setTimeout(()=> confettiOn=false, 4200);
}

function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  for (const p of confettiPieces){
    p.x += p.vx;
    p.y += p.vy;
    p.r += p.vr;
    p.vy += 0.03;

    ctx.save();
    ctx.globalAlpha = p.a;
    ctx.translate(p.x, p.y);
    ctx.rotate(p.r);
    ctx.fillStyle = p.c;
    ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    ctx.restore();
  }
  confettiPieces = confettiPieces.filter(p => p.y < confettiCanvas.height + 40);
  if (confettiOn || confettiPieces.length){
    requestAnimationFrame(drawConfetti);
  }
}

/* -----------------------------
   YES -> page2 (never fails)
------------------------------*/
document.getElementById("yesBtn").addEventListener("click", ()=>{
  showPage(2);
  window.scrollTo(0,0);
  spawnConfetti();
});

/* -----------------------------
   Envelope -> page3 + typing
------------------------------*/
const envelope = document.getElementById("envelope");
const typedText = document.getElementById("typedText");
const cursor = document.getElementById("cursor");

const letter =
`I can't wait to spend the rest of my life with you pooks.

You've given life a new purpose.
You've given me something to smile about every day.
You've given me a reason to be better every day.

I hope we grow into big back young adults, big back real adults,
and big back parents with our big back children.

I don't know what the future holds for us,
but I know with you by my side, everything will be going right.

Signed,
your tubby mans ðŸ’˜`;

let typingStarted = false;

function typeIt(text, speed=22){
  typedText.textContent = "";
  cursor.style.display = "inline-block";
  let i = 0;

  function tick(){
    typedText.textContent = text.slice(0, i);
    i++;
    if (i <= text.length){
      setTimeout(tick, speed);
    } else {
      cursor.style.display = "none";
    }
  }
  tick();
}

envelope.addEventListener("click", ()=>{
  showPage(3);
  if(!typingStarted){
    typingStarted = true;
    typeIt(letter, 18);
  }
});

/* -----------------------------
   NO BUTTON (REWRITTEN GAME LOGIC)
   Goal: never catchable + keeps moving while you chase.
------------------------------*/
// NO BUTTON (smooth runaway game)
const noBtn  = document.getElementById("noBtn");
const noZone = document.getElementById("noZone");
const yesBtn = document.getElementById("yesBtn");

let armed = false;

// button position (relative to noZone)
let x = 0, y = 0;
let vx = 0, vy = 0;

// pointer
let mx = 0, my = 0;
let inside = false;

// tune these
const SPEED = 7.5;        // how fast it runs
const PANIC_DIST = 160;   // starts fleeing when you get close
const FRICTION = 0.86;    // smoothness

function arm(){
  if (armed) return;

  // lock where it currently sits, then make it absolute
  const left = noBtn.offsetLeft;
  const top  = noBtn.offsetTop;

  noBtn.classList.add("runaway");
  x = left;
  y = top;

  noBtn.style.left = x + "px";
  noBtn.style.top  = y + "px";

  armed = true;
}

function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

function getBounds(){
  const z = noZone.getBoundingClientRect();
  const b = noBtn.getBoundingClientRect();
  return {
    w: z.width,
    h: z.height,
    bw: b.width,
    bh: b.height
  };
}

function tick(){
  if (!armed || !inside){
    requestAnimationFrame(tick);
    return;
  }

  const { w, h, bw, bh } = getBounds();

  // button center in zone coords
  const cx = x + bw/2;
  const cy = y + bh/2;

  // vector away from mouse (mouse coords are already zone-relative below)
  let dx = cx - mx;
  let dy = cy - my;
  const dist = Math.hypot(dx, dy) || 1;

  // If close: run away strongly. If not close: still drift so it never "stops".
  let ax = 0, ay = 0;

  if (dist < PANIC_DIST){
    dx /= dist; dy /= dist;
    ax = dx * SPEED;
    ay = dy * SPEED;
  } else {
    // gentle wandering so it doesn't freeze far away
    ax = (Math.random() - 0.5) * 0.35;
    ay = (Math.random() - 0.5) * 0.35;
  }

  vx = (vx + ax) * FRICTION;
  vy = (vy + ay) * FRICTION;

  x += vx;
  y += vy;

  // keep inside zone
  const pad = 8;
  const minX = pad;
  const minY = pad;
  const maxX = Math.max(minX, w - bw - pad);
  const maxY = Math.max(minY, h - bh - pad);

  // bounce off walls
  if (x <= minX){ x = minX; vx *= -0.9; }
  if (x >= maxX){ x = maxX; vx *= -0.9; }
  if (y <= minY){ y = minY; vy *= -0.9; }
  if (y >= maxY){ y = maxY; vy *= -0.9; }

  // never sit on top of YES
  const yes = yesBtn.getBoundingClientRect();
  const zone = noZone.getBoundingClientRect();
  const btnRect = {
    left: zone.left + x, top: zone.top + y,
    right: zone.left + x + bw, bottom: zone.top + y + bh
  };
  const overlap =
    !(btnRect.right < yes.left || btnRect.left > yes.right || btnRect.bottom < yes.top || btnRect.top > yes.bottom);

  if (overlap){
    // push away from YES
    x = clamp(x + (Math.random() < 0.5 ? -60 : 60), minX, maxX);
    y = clamp(y + (Math.random() < 0.5 ? -50 : 50), minY, maxY);
  }

  noBtn.style.left = x + "px";
  noBtn.style.top  = y + "px";

  requestAnimationFrame(tick);
}

// pointer coords in zone space
noZone.addEventListener("pointerenter", () => { inside = true; arm(); });
noZone.addEventListener("pointerleave", () => { inside = false; });
noZone.addEventListener("pointermove", (e) => {
  const r = noZone.getBoundingClientRect();
  mx = e.clientX - r.left;
  my = e.clientY - r.top;
});

// if you try click it, it instantly jumps away
noBtn.addEventListener("pointerdown", (e) => {
  e.preventDefault();
  arm();
  vx += (Math.random()<0.5?-1:1)*SPEED*2.2;
  vy += (Math.random()<0.5?-1:1)*SPEED*1.8;
});

requestAnimationFrame(tick);


// main game loop: while youâ€™re chasing, it keeps moving
function tick(){
  if(!rafRunning) return;

  const now = performance.now();

  // if cursor hasn't moved recently, don't spam teleports
  const activelyChasing = pointerInsideZone && (now - lastPointerMove < 250);

  if (activelyChasing){
    const b = noBtn.getBoundingClientRect();
    const cx = b.left + b.width/2;
    const cy = b.top  + b.height/2;

    const dist = Math.hypot(px - cx, py - cy);

    // move when close OR just to keep it â€œaliveâ€ while chasing
    const shouldJump =
      (dist < 220 && now - lastJump > 35) ||   // dodge when near
      (now - lastJump > 260);                  // keep moving even if you arenâ€™t close yet

    if (shouldJump){
      lastJump = now;
      teleportNo();
    }
  }

  requestAnimationFrame(tick);
}

// Track pointer globally
document.addEventListener("pointermove", (e)=>{
  px = e.clientX;
  py = e.clientY;
  lastPointerMove = performance.now();
});

// Know when pointer is inside the zone
noZone.addEventListener("pointerenter", ()=>{
  pointerInsideZone = true;
  if(!rafRunning){
    rafRunning = true;
    requestAnimationFrame(tick);
  }
});
noZone.addEventListener("pointerleave", ()=>{
  pointerInsideZone = false;
});

// If they somehow click/tap it, escape instantly
noBtn.addEventListener("pointerdown", (e)=>{
  e.preventDefault();
  px = e.clientX;
  py = e.clientY;
  lastPointerMove = performance.now();
  teleportNo();
});
</script>
</body>
</html>

